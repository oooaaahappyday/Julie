{% extends "JuliePlatformBundle::layout_gallery.html.twig" %}

{% block title %} {{parent() }} - Reportage{% endblock %}

	{% block left_side %}
		<p>zone upload et preview des photos</p>
		
	{% endblock left_side %}

	{% block right_side %}
		
		<div class"well">
			{{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}
			{{ form_errors(form) }}

			<div class="form-group"> {# Nom galerie #}
				{{ form_label(form.nom, "Nouvelle Galerie", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
				{{ form_errors(form.nom) }}
				<div class="col-sm-4">
					{{ form_widget(form.nom, {'attr': {'class': 'form-control'}}) }}
				</div>
			</div>

			<div class="form-group"> {# Date #}
				{{ form_label(form.date, "Date", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
				{{ form_errors(form.date) }}
				<div class="col-sm-4">
					{{ form_widget(form.date) }}
				</div>
			</div>

			<div class="form-group"> {# Pays #}
				{{ form_label(form.pays, "Pays", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
				{{ form_errors(form.pays) }}
				<div class="col-sm-4">
					{{ form_widget(form.pays, {'attr': {'class': 'form-control'}}) }}
				</div>
			</div>

			<div class="form-group"> {# Lieux #}
				{{ form_label(form.lieux, "Lieux", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
				{{ form_errors(form.lieux) }}
				<div class="col-sm-4">
					{{ form_widget(form.lieux, {'attr': {'class': 'form-control'}}) }}
				</div>
			</div>

			<div class="form-group"> {# Materiel #}
				{{ form_label(form.materiel, "Materiel", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
				{{ form_errors(form.materiel) }}
				<div class="col-sm-4">
					{{ form_widget(form.materiel, {'attr': {'class': 'form-control'}}) }}
				</div>
			</div>

			<div class="form-group"> {# Catégorie #}
				{{ form_label(form.categorie, "Catégorie", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
				{{ form_errors(form.categorie) }}
				<div class="col-sm-4">
					{{ form_widget(form.categorie, {'attr': {'class': 'form-control'}}) }}
				</div>
			</div>

			<script type="text/Javascript" src="{{ asset('/js/jquery-1.11.1.js')}}"></script>

			<script type="text/javascript">
			$(document).ready(function(){
				// get div with data-prototype attribute
				var $container = $('div#julie_platformbundle_galerie_images');
				// link to add new image
				var $addLink = $('<a href="#" id="add_images" class="btn btn-default">Ajouter une photo</a>');
				$container.append($addLink);

				// Add new field with each click on the AddLink
				$addLink.click(function(e){
					addImage($container);
					e.preventDefault(); // prevent the # in the URL
					return false;
				});

				// counter to name dynamically created fields
				var index = $container.find(':input').length;

				// create a first field if it doesn't exists
				if (index == 0){
					addImage($container);
				} else {
					// add delete link for each new image
					$container.children('div').each(function(){
						addDeleteLink($(this));
					});
				}

				// addImage function
				function addImage($container){
					// in data-prototype content: we replace
					// __name__titre__ -> field label
					// __name__        -> field name
					var $prototype = $($container.attr('data-prototype').replace(/__name__titre__/g, 'Photo n°' + (index+1)).replace(/__name__/g, index));

				// Add delete link to prototype
				addDeleteLink($prototype);

				// Add modified prototype and the end of the div
				$container.append($prototype);

				// Counter increment
				index++;
			}

				// addDeleteLink function
				function addDeleteLink($prototype){
					$deleteLink = $('<a href="#" class="btn btn-danger">Supprimer</a>');
					// Implement link
					$prototype.append($deleteLink);

					// Implement listener onclick
					$deleteLink.click(function(e){
						$prototype.remove();
						e.preventDefault();
						return false;
					});
				}
			});
</script>



<div class="form-group">
	<div class="col-sm-4 col-sm-offset-3">
		{{ form_widget(form.enregistrer, {'attr': {'class': 'btn btn-primary'}}) }}
	</div>
</div>

{{ form_rest(form) }}
{{ form_end(form) }}
</div>


{% endblock right_side %}